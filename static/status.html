<meta name="viewport" content="width=device-width,initial-scale=1" />

<h3>Latest post retrieved:</h3>
<span id="out">0</span><br>
<span id="rate">0</span> posts per second.

<script>
    // --- STATUS WEBSOCKET ---
    const ws2 = new WebSocket(`ws://${location.host}/status/ws`);
    window.now = 0;
    window.last = 0;

    ws2.onmessage = (e) => {
        const val = parseInt(e.data);
        if (!isNaN(val)) {
            window.now = val;
            document.getElementById('out').innerText = val;
        }
    };

    setInterval(() => {
        const rate = Math.max(0, (window.now - window.last) / 10); // posts/sec
        document.getElementById('rate').innerText = rate.toFixed(1);
        window.last = window.now;
    }, 10000); // every 10 seconds

    ws2.onclose = () => console.warn("Status WebSocket closed");
    ws2.onerror = (err) => console.error("Status WebSocket error:", err);
</script>

<hr>

<h3>Leaderboard:</h3>
<textarea id="leaderboard" rows="10" cols="30" readonly></textarea>

<script>
    // --- LEADERBOARD WEBSOCKET ---
    const ws3 = new WebSocket(`ws://${location.host}/leaderboard/ws`);
    const textarea = document.getElementById("leaderboard");

    ws3.onmessage = (e) => {
        try {
            const p = JSON.parse(e.data);
            textarea.value = "";
            p.forEach(([name, score]) => {
                textarea.value += `${name}: ${score}\n`;
            });
        } catch (err) {
            console.error("Leaderboard WS parse error:", err);
        }
    };

    ws3.onclose = () => console.warn("Leaderboard WebSocket closed");
    ws3.onerror = (err) => console.error("Leaderboard WebSocket error:", err);
</script>
